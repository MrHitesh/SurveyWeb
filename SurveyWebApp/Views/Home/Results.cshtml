@model SurveyWebApp.Models.ResultViewModel
@{
ViewData["Title"] = "Results";
}

<div>
    <h4>@Model.Survey.Title</h4>
    <div id="chartList" class="container" >
        </div>
    
        
    
</div>

@section Scripts {
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

        var quesText = '@Model.ResponseChartData[0].QuestionText';
        console.log(quesText);

         var model = @Json.Serialize(Model);
        console.log(model);

        var oneQues = model.responseChartData[0].chartRows;
        console.log(oneQues);

        // Load the Visualization API and the corechart package.
        google.charts.load('current', { 'packages': ['corechart'] });

        // Set a callback to run when the Google Visualization API is loaded.
        google.charts.setOnLoadCallback(drawChart);

        // Callback that creates and populates a data table,
        // instantiates the pie chart, passes in the data and
        // draws it.
        function drawChart() {

            for (var i = 0; i < model.responseChartData.length; i++) {

                $('#chartList').append('<div  class="card mt-3 mb-3"> \
                    <div class= "card-body" > \
                        <div id="chart_div'+i+'"></div> \
                    </div> \
                 </div>');

                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Choice');
                data.addColumn('number', 'Count');

                var rowsToAdd = [];
                for (var j = 0; j < model.responseChartData[i].chartRows.length; j++) {
                    rowsToAdd.push([model.responseChartData[i].chartRows[j].choiceText, model.responseChartData[i].chartRows[j].count]);
                }
                console.log("rowstoadd", rowsToAdd);

                data.addRows(rowsToAdd);

                //data.addRows([
                //    ['Mushrooms', 3],
                //    ['Onions', 1],
                //    ['Olives', 1],
                //    ['Zucchini', 1],
                //    ['Pepperoni', 2]
                //]);

                // Set chart options
                var options = {
                    'title': quesText,
                    'width': 800,
                    'height': 200,
                    'chartArea': { left: 1, top: 20, width: '100%', height: '75%' }
                };

                var chart = new google.visualization.PieChart(document.getElementById('chart_div' + i));
                chart.draw(data, options);

            }

            // Create the data table.
            
            // Instantiate and draw our chart, passing in some options.

          
           
        }
    </script>
}
